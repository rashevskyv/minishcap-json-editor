# План оновлення логіки перевірки та виправлення порожніх рядків

## 1. Огляд Завдання

Поточна логіка для виявлення та виправлення проблем з порожніми рядками в діалогах базується на застарілих правилах для 2-рядкових діалогових вікон. У грі The Legend of Zelda: The Wind Waker діалогові вікна вміщують 4 рядки тексту.

**Мета:** Оновити механізм, щоб він коректно працював з 4-рядковою сіткою. Попередження має з'являтися, якщо перший рядок будь-якої "сторінки" (кожного 4-рядкового блоку) порожній, але наступні рядки на тій самій сторінці містять текст. Автовиправлення повинно усувати цей порожній рядок.

## 2. Ідентифікація файлів та функцій

Логіка, що потребує змін, розташована в наступних файлах плагіна `zelda_ww`:

1.  **`plugins/zelda_ww/problem_analyzer.py`**: Відповідає за виявлення проблем у тексті.
    *   **Функція для зміни:** `check_for_empty_first_line_of_two`

2.  **`plugins/zelda_ww/text_fixer.py`**: Відповідає за автоматичне виправлення виявлених проблем.
    *   **Функція для зміни:** `fix_empty_first_line_of_two`

3.  **`plugins/zelda_ww/rules.py`**: Реєструє аналізатори та виправлення для їх використання в додатку.
    *   **Функції для зміни:** `get_problem_checkers` та `get_text_fixers` (для оновлення посилань на перейменовані функції).

## 3. Детальний план змін

### Крок 1: Модифікація `problem_analyzer.py`

1.  **Перейменувати функцію:** `check_for_empty_first_line_of_two` -> `check_for_empty_first_line_of_page`.
2.  **Оновити логіку:**
    *   Функція буде ітерувати по рядках тексту, використовуючи індекс `i`.
    *   Перевірка буде відбуватися для кожного рядка, індекс якого є початком нової 4-рядкової сторінки (тобто `i % 4 == 0`).
    *   Умова для попередження буде спрацьовувати, якщо:
        *   Поточний рядок `lines[i]` порожній.
        *   Існує хоча б один непустий рядок у межах поточної 4-рядкової сторінки (`lines[i+1]`, `lines[i+2]`, `lines[i+3]`). Це запобігає помилковим спрацьовуванням на навмисних порожніх блоках.
3.  **Оновити текст попередження:** Повідомлення про помилку буде змінено, щоб відображати нове правило (наприклад, "Перший рядок 4-рядкової сторінки порожній, але наступні містять текст").

### Крок 2: Модифікація `text_fixer.py`

1.  **Перейменувати функцію:** `fix_empty_first_line_of_two` -> `fix_empty_first_line_of_page`.
2.  **Оновити логіку автовиправлення:**
    *   Функція буде знаходити всі проблемні рядки, що відповідають новій логіці з `problem_analyzer.py`.
    *   Для кожного знайденого порожнього рядка на початку сторінки, функція буде його видаляти, зсуваючи всі наступні рядки вгору.

### Крок 3: Модифікація `rules.py`

1.  **Оновити реєстрацію функцій:**
    *   У методі `get_problem_checkers` замінити стару назву `check_for_empty_first_line_of_two` на нову `check_for_empty_first_line_of_page`.
    *   У методі `get_text_fixers` замінити стару назву `fix_empty_first_line_of_two` на нову `fix_empty_first_line_of_page`.

TODO
TODO: Ділити едітор розділювачем по 4 строки, а не по 2
TODO: Додати додавання блоків та розділення блока н логічні підблоки 