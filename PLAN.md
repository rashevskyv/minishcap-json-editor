# План оновлення та розширення функціоналу

## Загальний список завдань:

1.  **Адаптація до 4-рядкових діалогових вікон:** Оновлення логіки перевірки порожніх рядків та візуального розділювача в редакторі для відповідності 4-рядковій сітці гри.
2.  **Покращення контексту для AI-перекладу:** Модифікація запитів до AI для збереження загального контексту при перекладі блоків та акцентування уваги на релевантних термінах глосарію.
3.  **Реалізація керування блоками:** Додавання функціоналу для створення нових блоків та розділення існуючих.

---

## 1. Адаптація до 4-рядкових діалогових вікон

### 1.1. Огляд Завдання

Поточна логіка перевірки порожніх рядків та візуальний розділювач в редакторі орієнтовані на 2-рядкові діалоги. Необхідно адаптувати їх для 4-рядкових діалогових вікон гри *The Legend of Zelda: The Wind Waker*.

### 1.2. Підзавдання A: Оновлення логіки перевірки порожніх рядків

**Мета:** Попередження має з'являтися, якщо перший рядок "сторінки" (кожного 4-рядкового блоку) порожній, а наступні містять текст. Автовиправлення має видаляти такий рядок.

**Файли для зміни:**
*   `plugins/zelda_ww/problem_analyzer.py`
*   `plugins/zelda_ww/text_fixer.py`
*   `plugins/zelda_ww/rules.py`

**Детальний план:**
1.  **Модифікація `problem_analyzer.py`:**
    *   Перейменувати функцію `check_for_empty_first_line_of_two` на `check_for_empty_first_line_of_page`.
    *   Оновити логіку для ітерації по рядках з кроком 4 (`i % 4 == 0`).
    *   Умова спрацьовування: `lines[i]` порожній, АЛЕ будь-який з `lines[i+1]` до `lines[i+3]` містить текст.
2.  **Модифікація `text_fixer.py`:**
    *   Перейменувати `fix_empty_first_line_of_two` на `fix_empty_first_line_of_page`.
    *   Оновити логіку для видалення порожніх рядків, що відповідають новим правилам.
3.  **Модифікація `rules.py`:**
    *   Оновити посилання на перейменовані функції в `get_problem_checkers` та `get_text_fixers`.

### 1.3. Підзавдання B: Оновлення візуального розділювача в редакторі

**Мета:** Змінити візуальний розділювач у текстових редакторах, щоб він з'являвся кожні 4 рядки замість 2.

**Файли для зміни:**
*   `components/LNET_paint_event_logic.py`
*   `plugins/base_game_rules.py`
*   `plugins/zelda_ww/rules.py`

**Детальний план:**
1.  **Зробити розмір сторінки конфігурованим:**
    *   У `plugins/base_game_rules.py` додати метод `get_editor_page_size() -> int`, що повертає `2` за замовчуванням.
    *   У `plugins/zelda_ww/rules.py` перевизначити цей метод, щоб він повертав `4`.
2.  **Оновити логіку малювання:**
    *   У `components/LNET_paint_event_logic.py` знайти перевірку `(doc_visual_line_index + 1) % 2 == 0`.
    *   Замінити її на динамічну логіку, що викликає `get_editor_page_size()` з поточного плагіна для визначення періодичності розділювача.
